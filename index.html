<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Udacity todo Goals</title>
</head>
<body>
    <div>
        <h1>Todo List</h1>
        <input type="text" id="todo" placeholder="ADD Todo">
        <button id="todoBtn">ADD Todo</button>
        <ul id="todos"></ul>
    </div>  
    <div>
        <h1>Goal List</h1>
        <input type="text" id="goal" placeholder="ADD Goal">
        <button id="goalBtn">ADD Goal</button>
        <ul id="goals"></ul>
    </div>

    <script type='text/javascript'>
    function generateid(){
        return Math.random().toString(36).substring(2)+(new Date()).getTime().toString(36);
    }     
            const ADD_TODO  = 'ADD_TODO';
            const REMOVE_TODO = 'REMOVE_todo'; 
            const ADD_GOAL = 'ADD_GOAL'; 
            const REMOVE_GOAL = 'REMOVE_GOAL'; 
            const TOGGLE_TODO = 'TOGGLE_TODO';
            
            function addTodoAction(todo){
                return {
                    type:ADD_TODO,
                    todo,
                }
            }
            function removeTodoAction(id){
                return {
                    type: REMOVE_TODO,
                    id,
                }
            } 
            function toggleTodoAction(id){
                return  {
                    type : TOGGLE_TODO, 
                    id,
                }
            }
            function addGoalAction(goal){
                return {
                    type :  ADD_GOAL , 
                    goal,}}  
            function removeGoalAction(id){
                return{
                    type : REMOVE_GOAL,  
                    id , }}
            function todos (state =[],  action){ 
                switch(action.type){
                    case ADD_TODO:  
                    return state.concat([action.todo]);  
                    case 'REMOVE_TODO': 
                    return state.filter((st)=>st.id!==action.id); 
                    case 'TOGGLE_TODO' : 
                    return state.map((todo)=> todo.id!==action.id ?  todo : 
                        Object.assign({} ,  todo ,  {complete: !todo.complete}));
                    default : 
                    return state ; 
                }
            } 
            function goals (state =[], action){ 
                switch(action.type){
                    case 'ADD_GOAL': 
                        return state.concat([action.goal]);
                    case 'REMOVE_GOAL': 
                        return state.filter((goal)=>goal.id === action.id); 
                    default : 
                        return state;
                }
            }
            function app (state =[],  action ){
                return {
                    todo :  todos(state.todo , action), 
                    goals :  goals(state.goals , action)
                }
            }

            // Library

            function createState(app){

                // the state tree
                // a way to get the state tree
                // a way to listen and respond to the state changing
                // a way to update the state
                let state ;  
                let listeners =[]
                const getState  =  ()=> state ;   
                const subscribe = (listener)=>{
                    listeners.push(listener);  
                    return  ()=>{
                        listners =  listeners.filter((l)=> l!==listener); 
                    }

                }
                const  dispatch = (action)=>{
                    state =  app(state ,  action);  
                    listeners.forEach((listener)=>listener()); 
                }
                return {
                    getState,  
                    subscribe ,  
                    dispatch
                };   
            }
            const store =  createState(app);  



            store.subscribe(()=>{
                console.log(store.getState()); 
                const {goals , todo} = store.getState();  
                document.getElementById('goals').innerHTML =''; 
                document.getElementById('todos').innerHTML =''; 
                goals.forEach(addGoalTodom); 
                todo.forEach(addTodoTodom); 

            });  
            

            function addTodo(){
                const input =  document.getElementById('todo'); 
                const name = input.value;  
                if (name !=="") {
                store.dispatch(addTodoAction({
                    name,
                    complete :  false,  
                    id: generateid()
                }))}  
                else {
                    alert('Todo input is already empty');
                }
                input.value =  "";
            }
            function addGoal(){
                const input =  document.getElementById('goal'); 
                const name = input.value; 
                if(name !=="") {
                store.dispatch(addGoalAction({
                    id:generateid(),
                    name, 
                }))} 
                else{
                    alert('Goal input is emplty');  
                }
                input.value='' ; 
            }
        document.getElementById('todoBtn')
            .addEventListener('click' ,  addTodo); 
        document.getElementById('goalBtn')
            .addEventListener('click' ,  addGoal); 
        

        function addTodoTodom(todo){
            
            const  node =  document.createElement('li');  
            const text = document.createTextNode(todo.name);  
            node.appendChild(text);
            node.style.textDecoration =  todo.complete ? 'line-through':  'none' ;  
            node.addEventListener('click',()=>{
                store.dispatch(toggleTodoAction(todo.id))
            })
            document.getElementById('todos').append(node)  
        }
        function addGoalTodom(goal){ 

            const node = document.createElement('li');
            const text =  document.createTextNode(goal.name); 
            node.appendChild(text); 
            document.getElementById('goals')
            .append(node); 
         }
                
    </script>
</body>
</html>


 <!-- store.dispatch(addTodoAction({
    //         id :0 , 
    //         name : 'Learn Redux' , 
    //         complete :  false 
    //     }));
    // store.dispatch(removeTodoAction(1));
    // store.dispatch({
    //     type : ADD_TODO,
    //     todo : {
    //         id :0 , 
    //         name : 'Learn Redux' , 
    //         complete :  false 
    //     }
        
    // });store.dispatch(addGoalAction({
    //         id :0 , 
    //         name : 'Learn Redux' , 
    //         complete :  false 
    //     })
    // );
    // store.dispatch(removeGoalAction(0));
    // const  unsubscribe = store.subscribe(()=>{
    //     console.log('the store changes'); 
    // });   -->